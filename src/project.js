__require=function e(t,n,i){function s(r,a){if(!n[r]){if(!t[r]){var l=r.split("/");if(l=l[l.length-1],!t[l]){var c="function"==typeof __require&&__require;if(!a&&c)return c(l,!0);if(o)return o(l,!0);throw new Error("Cannot find module '"+r+"'")}}var h=n[r]={exports:{}};t[r][0].call(h.exports,function(e){return s(t[r][1][e]||e)},h,h.exports,e,t,n,i)}return n[r].exports}for(var o="function"==typeof __require&&__require,r=0;r<i.length;r++)s(i[r]);return s}({Define:[function(e,t,n){"use strict";cc._RF.push(t,"20050slwqJCoZLZJDJQGhGg","Define"),window.CandyType={lollipop:0,gumdrop:1,apple:2,icecube:3},window.SCREEN_W=1920,window.SCREEN_H=1080,window.SPAWN_TIME=1,window.SPEED_SLOW=2,window.TIME_SLOW=5,window.KEY_REDIRECT={LEFT_PRESSED:"LEFT_DOWN",RIGHT_PRESSED:"RIGHT_DOWN",LEFT_RELEASED:"LEFT_UP",RIGHT_RELEASED:"RIGHT_UP"},window.PLAYER_TYPE={PLAYER_1:"player1",PLAYER_2:"player2"},window.TARGET={1:{lollipop:3,gumdrop:2},2:{lollipop:6,gumdrop:6},3:{lollipop:7,gumdrop:3},4:{lollipop:3,gumdrop:7},5:{lollipop:8,gumdrop:8}},window.COUNTDOWN_TIME=60,window.GAME_RESULT={WIN:"YOU WIN!",LOSE:"YOU LOSE",SAME:"SAME POINTS"},cc._RF.pop()},{}],EventHandler:[function(e,t,n){"use strict";cc._RF.push(t,"2221dsRJQ5N4JSSgQ/6UX9l","EventHandler");var i=cc.Class({ctor:function(){this.initEvent()},statics:{instance:null,getInstance:function(){return this.instance||(this.instance=new i),this.instance}},initEvent:function(){this.fillOrderListener=[],this.eventTarget=new cc.EventTarget},registerFillOrderEvent:function(e){-1==this.fillOrderListener.indexOf(e)&&this.fillOrderListener.push(e)},unRegisterFillOrderEvent:function(e){var t=this.fillOrderListener.indexOf(e);-1!=t&&this.fillOrderListener.splice(t,1)},triggerFillOrderEvent:function(e){this.triggerEvent(this.fillOrderListener,e)},triggerEvent:function(e,t){var n=!0,i=!1,s=void 0;try{for(var o,r=e[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){(0,o.value)(t)}}catch(e){i=!0,s=e}finally{try{!n&&r.return&&r.return()}finally{if(i)throw s}}}});cc._RF.pop()},{}],GameSparksRTMgr:[function(e,t,n){"use strict";cc._RF.push(t,"019b9obGI9IQbeHKdiX9+VV","GameSparksRTMgr"),window.GameSparks=e("gamesparks"),window.GameSparksRT=e("gamesparks-rt").GameSparksRT,window.RTData=e("gamesparks-rt").RTData;var i=cc.Class({extends:cc.Component,properties:{apikey:cc.String,apiSecret:cc.String,userName:cc.String,logNode:cc.Node},statics:{instance:null},onLoad:function(){i.instance=this,this.connectParticipants=null,this.StringLog=this.logNode.getChildByName("logString").getComponent(cc.Label),this.isMultiplayer=!1},showLogLayout:function(){this.logNode.active=!0},hideLogLayout:function(){this.logNode.active=!1},setLogging:function(e){this.StringLog.string="Connecting...\n"+e},startMultiplayer:function(){this.setLogging("Multiplayer Initting..."),this.initRTSession(),this.initGameSparks(),this.ready=!1,this.playerID="",this.RTMessagesListeners={},this.RTConnectedListener={},this.isMultiplayer=!0},start:function(){},initGameSparks:function(){this.gamesparks=new GameSparks;var e={key:this.apikey,secret:this.apiSecret,onNonce:this.onNonce.bind(this),onInit:this.onInit.bind(this),onMessage:this.onMessage.bind(this),logger:console.log.bind(console)};this.gamesparks.initPreview(e)},onNonce:function(e){return CryptoJS.enc.Base64.stringify(CryptoJS.HmacSHA256(e,this.apiSecret))},onInit:function(){console.log("#GS Initialized"),this.setLogging("Multiplayer Initialized"),this.ready=!0,this.login()},onMessage:function(e){if(console.log("#GS ",JSON.stringify(e)),".MatchFoundMessage"===e["@class"]){this.setLogging("Multiplayer Match Found");var t=e.accessToken,n=e.host,i=e.port;this.myRTSession.stop(),this.myRTSession.start(t,n,i),this.matchId=e.matchId,this.playerID=e.playerId,console.log("HOAN ",e.participants[1].displayName),this.connectParticipants=e.participants}else".MatchNotFoundMessage"===e["@class"]&&(console.log("#GS MATCH NOT FOUND"),this.setLogging("Multiplayer Match Not Found"),this.sendMatchmakingRequest())},login:function(){if(this.ready){var e={userName:this.userName,password:this.userName};this.gamesparks.sendWithData("AuthenticationRequest",e,this.onLoginResponse.bind(this))}else console.log("#GS Gamesparks is not ready")},onLoginResponse:function(e){e.error?(console.log("#GS login failed!: ",e.error),this.setLogging("Multiplayer on Login ERROR!!!!"),this.register()):(console.log("#GS login successed! ",e),this.setLogging("Multiplayer on Login SUCCESSED!!!!"),this.sendMatchmakingRequest())},register:function(){var e={displayName:this.userName,userName:this.userName,password:this.userName};this.setLogging("Multiplayer on registering new player..."),console.log("#GS request register: ",e),this.gamesparks.sendWithData("RegistrationRequest",e,this.onRegisterResponse.bind(this))},onRegisterResponse:function(e){e.error?(console.error("register",e.error),this.setLogging("Multiplayer on registering ERROR!!!")):(console.log("register success",e),this.setLogging("Multiplayer on registering SUCCESSED!!!"))},sendMatchmakingRequest:function(){var e={matchShortCode:"Demo",matchGroup:"112233",participantData:{playerID:this.userName},skill:0};this.setLogging("Multiplayer sendMatchmakingRequest..."),this.gamesparks.sendWithData("MatchmakingRequest",e,this.onMatchResponse.bind(this))},onMatchResponse:function(e){console.log("#GS onMatchResponse",e)},initRTSession:function(){this.myRTSession={started:!1,onPlayerConnect:this.onPlayerConnected.bind(this),onPlayerDisconnect:this.onPlayerDisconnected.bind(this),onReady:this.onSessionReady.bind(this),onPacket:this.onPacketReceived.bind(this),session:null,start:this.startRTSession.bind(this),stop:this.stopRTSession.bind(this),log:this.log.bind(this)}},onPlayerConnected:function(e){console.log("onPlayerConnectedCB",e)},onPlayerDisconnected:function(e){console.log("onPlayerDisconnected",e)},onSessionReady:function(e){console.log("onSessionReady",e);var t=RTData.get();t.setString(1,this.userName),this.myRTSession.session.sendRTData(GS_REQUEST_CODE.INIT,GameSparksRT.deliveryIntent.RELIABLE,t,[0]),this.hideLogLayout()},registerOpCodeCallback:function(e,t){this.RTMessagesListeners[e]||(this.RTMessagesListeners[e]=[]),-1==this.RTMessagesListeners[e].indexOf(t)&&this.RTMessagesListeners[e].push(t)},onPacketReceived:function(e){console.log("onPacketReceived",e),this.triggerCallback(e.opCode,e.data)},triggerCallback:function(e,t){var n=this.RTMessagesListeners[e];if(n)for(var i in n)n[i](t)},startRTSession:function(e,t,n){var i,s=t.indexOf(":");i=s>0?t.slice(0,s):t,console.log(i+" : "+n),this.myRTSession.session=GameSparksRT.getSession(e,i,n,this.myRTSession),null!=this.myRTSession.session?(this.myRTSession.started=!0,this.myRTSession.session.start()):this.myRTSession.started=!1},forceCloseWebsocket:function(){this.gamesparks.reset(),this.stopRTSession()},stopRTSession:function(){this.myRTSession.started=!1,null!=this.myRTSession.session&&this.myRTSession.session.stop()},log:function(e){var t="|";for(var n in myRTSession.session.activePeers)t=t+myRTSession.session.activePeers[n]+"|";console.log(myRTSession.session.peerId+": "+e+" peers:"+t)},onMovePlayer:function(e,t){var n=RTData.get();n.setString(1,e),n.setLong(2,t),this.myRTSession.session.sendRTData(GS_REQUEST_CODE.KEY_DIRECT_DOWN,GameSparksRT.deliveryIntent.RELIABLE,n,[0])},onRequestGainScore:function(e){var t=RTData.get();t.setString(1,e),this.myRTSession.session.sendRTData(GS_REQUEST_CODE.GAIN_SCORE,GameSparksRT.deliveryIntent.RELIABLE,t,[0])},onRequestSpawNewCandy:function(e){var t=RTData.get();t.setString(1,e),this.myRTSession.session.sendRTData(GS_REQUEST_CODE.SPAWN_NEW_CANDY,GameSparksRT.deliveryIntent.RELIABLE,t,[0])},update:function(){this.myRTSession&&this.myRTSession.started&&this.myRTSession.session.update()}});cc._RF.pop()},{gamesparks:"gamesparks","gamesparks-rt":"gamesparks-rt"}],Game:[function(e,t,n){"use strict";cc._RF.push(t,"bfdff59c6VNM6Swmve2MvZY","Game");var i=e("EventHandler"),s=cc.Class({extends:cc.Component,properties:{candyPrefab:cc.Prefab,playerPrefab:cc.Prefab,Node_countDownTime:cc.Node,Node_result:cc.Node},statics:{instance:null},onLoad:function(){s.instance=this,this.startGame()},startGame:function(){this.timer=COUNTDOWN_TIME,this.player=cc.instantiate(this.playerPrefab),this.player.getComponent("playerMgr").setPlayerType(PLAYER_TYPE.PLAYER_1),this.player2=null,this.player.parent=this.node;var e=this;i.getInstance().eventTarget.once("JoinMultiplayer",function(){e.PrepairMultiplayer()}),this.autoSpawnNewCandy()},resetTimer:function(){this.timer=COUNTDOWN_TIME},doCountdownTime:function(){this.timer>0&&this.timer--,this.Node_countDownTime.getComponent(cc.Label).string=""+this.timer},startCountdownTimer:function(){this.callback=function(){this.timer<=0?(this.unschedule(this.callback),this.showResult()):this.scheduleOnce(function(){this.doCountdownTime()},1)},this.schedule(this.callback,SPAWN_TIME)},showResult:function(){this.Node_result.active=!0,this.setResult()},getResult:function(){var e=this.player.getComponent("playerMgr").getScore(),t=this.player2.getComponent("playerMgr").getScore();return e>t?GAME_RESULT.WIN:e<t?GAME_RESULT.LOSE:e==t?GAME_RESULT.SAME:void 0},setResult:function(){this.Node_result.getChildByName("result").getComponent(cc.Label).string=""+this.getResult()},spawnNewCandy:function(){var e=cc.instantiate(this.candyPrefab);e.setPosition(this.getNewCandyPosition()),e.getComponent("candy").setType(this.getNewCandyType()),e.getComponent("candy").game=this,this.node.addChild(e)},MultiPlayerSpawnNewCandy:function(e,t,n){var i=cc.instantiate(this.candyPrefab);i.setPosition(e,t),i.getComponent("candy").setType(n),i.getComponent("candy").game=this,this.node.addChild(i)},PrepairMultiplayer:function(){this.GameJoinningMultiplayer=!0,this.node.removeAllChildren()},autoSpawnNewCandy:function(){this.callback=function(){this.GameJoinningMultiplayer?this.unschedule(this.callback):this.scheduleOnce(function(){this.spawnNewCandy()},1)},this.schedule(this.callback,SPAWN_TIME)},getNewCandyType:function(){return Math.floor(4*Math.random())},getNewCandyPosition:function(){var e,t=this.node.height/2+40,n=this.node.width/2;return e=2*(Math.random()-.5)*n,cc.v2(e,t)},restartGame:function(){this.node.removeAllChildren(),this.GameJoinningMultiplayer=!1,this.startGame(),i.getInstance().eventTarget.emit("Restart")}});cc._RF.pop()},{EventHandler:"EventHandler"}],MultiplayerMgr:[function(e,t,n){"use strict";cc._RF.push(t,"b1c69SfDDFNAZIGCbvxLB4L","MultiplayerMgr");var i=e("EventHandler"),s=e("GameSparksRTMgr"),o=e("Game");cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.peerDisplayName="",this.game=o.instance},onStartConnectServer:function(){this.node.active=!0,i.getInstance().eventTarget.emit("JoinMultiplayer"),s.instance.startMultiplayer(),s.instance.registerOpCodeCallback(GS_RESPONSE_CODE.INIT,this.onPlayer2ConnectSuccess.bind(this)),s.instance.registerOpCodeCallback(GS_RESPONSE_CODE.KEY_DIRECT_DOWN,this.onMovePlayer2.bind(this)),s.instance.registerOpCodeCallback(GS_RESPONSE_CODE.SPAWN_NEW_CANDY,this.onMultiSpawnNewCandy.bind(this)),s.instance.registerOpCodeCallback(GS_RESPONSE_CODE.GAIN_SCORE,this.onMultiGainScore.bind(this))},onPlayer2ConnectSuccess:function(){var e=this;s.instance.connectParticipants.forEach(function(t){t.id!=s.instance.playerID&&(e.peerDisplayName=t.displayName)}),this.GameInitMultiplayer(this.peerDisplayName)},GameInitMultiplayer:function(e){this.game.player2=null,this.game.player=cc.instantiate(this.game.playerPrefab),this.game.player2=cc.instantiate(this.game.playerPrefab),this.game.player.parent=this.node,this.game.player2.parent=this.node,this.game.player.getComponent("playerMgr").initplayerMulti(PLAYER_TYPE.PLAYER_1),this.game.player2.getComponent("playerMgr").initplayerMulti(PLAYER_TYPE.PLAYER_2),this.MultiAutoSpawnNewCandy(),this.game.startCountdownTimer()},onMultiGainScore:function(e){var t=e.getString(1);e.getString(2)!=s.instance.playerID&&this.game.player2.getComponent("playerMgr").setScoreDisplay(t)},onMultiSpawnNewCandy:function(e){var t=Number(e.getString(1)),n=Number(e.getString(2)),i=Number(e.getString(3));this.game.MultiPlayerSpawnNewCandy(t,n,i)},MultiAutoSpawnNewCandy:function(){this.callback=function(){this.game.timer<=0?this.unschedule(this.callback):this.scheduleOnce(function(){s.instance.onRequestSpawNewCandy("Request")},5)},this.schedule(this.callback,1)},onMovePlayer2:function(e){var t=e.getString(1),n=e.getString(2),i=e.getString(3);if(n!=s.instance.playerID)switch(t){case KEY_REDIRECT.LEFT_PRESSED:this.game.player2.getComponent("playerMgr").P2_accLeft=!0,this.game.player2.getComponent("playerMgr").P2_posX=Number(i);break;case KEY_REDIRECT.RIGHT_PRESSED:this.game.player2.getComponent("playerMgr").P2_accRight=!0,this.game.player2.getComponent("playerMgr").P2_posX=Number(i);break;case KEY_REDIRECT.LEFT_RELEASED:this.game.player2.getComponent("playerMgr").P2_accLeft=!1,this.game.player2.getComponent("playerMgr").P2_posX=Number(i);break;case KEY_REDIRECT.RIGHT_RELEASED:this.game.player2.getComponent("playerMgr").P2_accRight=!1,this.game.player2.getComponent("playerMgr").P2_posX=Number(i)}}}),cc._RF.pop()},{EventHandler:"EventHandler",Game:"Game",GameSparksRTMgr:"GameSparksRTMgr"}],OrderMgr:[function(e,t,n){"use strict";cc._RF.push(t,"bdf4fpIp2tM6YhNUylvQGvg","OrderMgr");var i=e("EventHandler"),s=e("Game");cc.Class({extends:cc.Component,properties:{node_lollipop:cc.Node,node_gumdrop:cc.Node},onLoad:function(){this.InitOrder()},InitOrder:function(){this.lollipop_picked=0,this.gumdrop_picked=0,this.currentOrder=1,i.getInstance().registerFillOrderEvent(this.fillOrder.bind(this));var e=this;i.getInstance().eventTarget.once("Restart",function(){e.reset()}),this.RefillOrderTarget(this.currentOrder)},RefillOrderTarget:function(e){TARGET[e]&&(this.node_lollipop.getComponent(cc.Label).string=this.lollipop_picked+"/"+TARGET[e].lollipop,this.node_gumdrop.getComponent(cc.Label).string=this.gumdrop_picked+"/"+TARGET[e].gumdrop)},fillOrder:function(e){e==CandyType.lollipop&&this.lollipop_picked++,e==CandyType.gumdrop&&this.gumdrop_picked++,e==CandyType.apple&&this.resetTargetOrder(),e==CandyType.icecube&&s.instance.player.getComponent("playerMgr").Slowdown(),this.RefillOrderTarget(this.currentOrder),this.checkFullfillOder()},checkFullfillOder:function(){this.lollipop_picked>=TARGET[this.currentOrder].lollipop&&this.gumdrop_picked>=TARGET[this.currentOrder].gumdrop&&(s.instance.player.getComponent("playerMgr").gainScore(),this.currentOrder++,this.resetTargetOrder())},resetTargetOrder:function(){this.lollipop_picked=0,this.gumdrop_picked=0,this.RefillOrderTarget(this.currentOrder)},reset:function(){console.log("RESETTTTTTTTTTTTTTTT"),i.getInstance().unRegisterFillOrderEvent(this.fillOrder.bind(this)),this.InitOrder()}}),cc._RF.pop()},{EventHandler:"EventHandler",Game:"Game"}],ServerCode:[function(e,t,n){"use strict";cc._RF.push(t,"c5eb5DFskpPUbRqzOquupFz","ServerCode"),window.GS_REQUEST_CODE=cc.Enum({INIT:100,KEY_DIRECT_DOWN:101,GAIN_SCORE:102,SPAWN_NEW_CANDY:105}),window.GS_RESPONSE_CODE=cc.Enum({INIT:200,KEY_DIRECT_DOWN:201,GAIN_SCORE:202,SPAWN_NEW_CANDY:205}),cc._RF.pop()},{}],candy:[function(e,t,n){"use strict";cc._RF.push(t,"fd735XDR8xH9ZD27O+Xto5K","candy");var i=e("EventHandler");cc.Class({extends:cc.Component,properties:{pickRadius:0,dropSpeed:1,ImageCandy:{default:[],type:cc.SpriteFrame},type:-1},setType:function(e){this.type=e,this.setNewCandyImage()},getType:function(){return this.type},setNewCandyImage:function(){this.node.getComponent(cc.Sprite).spriteFrame=this.ImageCandy[this.getType()]},getPlayerDistance:function(){var e=this.game.player.getPosition();return this.node.position.sub(e).mag()},getPlayer2Distance:function(){var e=this.game.player2.getPosition();return this.node.position.sub(e).mag()},onPicked:function(){i.getInstance().triggerFillOrderEvent(this.getType()),this.node.destroy()},update:function(e){this.game.player&&this.getPlayerDistance()<this.pickRadius?this.onPicked():((this.game.player2&&this.getPlayer2Distance()<this.pickRadius||this.node.y<-this.game.node.width/2)&&this.node.destroy(),this.node.y-=this.dropSpeed)}}),cc._RF.pop()},{EventHandler:"EventHandler"}],"gamesparks-rt":[function(e,t,n){"use strict";cc._RF.push(t,"960496WsWRP7pEK3i/voKMd","gamesparks-rt");var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s={LOGIN_RESULT:-1,PING_RESULT:-3,UDP_CONNECT_MESSAGE:-5,PLAYER_READY_MESSAGE:-7,PLAYER_CONNECT_MESSAGE:-101,PLAYER_DISCONNECT_MESSAGE:-103},o=function(e){this.session=e,this.stopped=!1};o.prototype={stop:function(){this.stopped=!0,this.stopInternal()},onPacketReceived:function(e,t){var n;if(e.command)if(e.command.abstractResultType){var i=e.command;i.configure(e,this.session),i.executeAsync()?this.session.submitAction(e.command):e.command.execute()}else this.session.submitAction(e.command);else e.hasPayload||(n=e.sender?y.pool.pop().configure(e.opCode,e.sender,null,e.data,0,this.session,t):y.pool.pop().configure(e.opCode,0,null,e.data,0,this.session,t))&&this.session.submitAction(n)}};var r=function(e,t,n){o.call(this,n),this.remotehost=e,this.remoteport=t};(r.prototype=Object.create(o.prototype)).connect=function(){this.client=new WebSocket("wss://"+this.remotehost+":"+this.remoteport),this.client.binaryType="arraybuffer",this.client.onopen=this.onopen.bind(this),this.client.onclose=this.onclose.bind(this),this.client.onerror=this.onerror.bind(this),this.client.onmessage=this.onmessage.bind(this)},r.prototype.onopen=function(e){if(console.log("ReliableConnection onOpen"),this.stopped||null==this.session)null!=this.client&&(this.client.close(),this.client=null);else{this.session.log("ReliableConnection",G.logLevel.DEBUG," TCP Connection Established");var t=new T(this.session.connectToken);this.send(t)}},r.prototype.onmessage=function(e){if(console.log("ReliableConnection onMessage"),this.stopped)null!=this.client&&(this.client.close(),this.client=null);else{var t=e.data,n=t.byteLength,i=new h,s=Array.from(new Uint8Array(t));for(i.writeBytes(s,0,n),i.setPosition(0);i.getPosition()<n;){var o=k.packetPool.pop(),r=this.read(i,o);this.onPacketReceived(o,r),k.packetPool.push(o),o=k.packetPool.pop()}}},r.prototype.onclose=function(e){console.log("ReliableConnection onclose"),null!=this.session&&this.session.log("ReliableConnection",G.logLevel.DEBUG," TCP Connection Closed"),this.stopped||null==this.client?console.log("ReliableConnection close"):console.log("ReliableConnection trying reconnect")},r.prototype.onerror=function(e){console.log("ReliableConnection onerror"),null!=this.session&&this.session.log("ReliableConnection",G.logLevel.DEBUG," TCP Connection Error"),console.log(e)},r.prototype.send=function(e){if(null!=this.client&&this.client.readyState==WebSocket.OPEN){var t=new h,n=e.toPacket(this.session,!1),i=N.serializeLengthDelimited(t,n),s=new Uint8Array(t.getBuffer());return this.client.send(s),k.packetPool.push(n),i}return-1},r.prototype.read=function(e,t){if(this.stopped)return 0;t.session=this.session,t.reliable=!0;var n=N.deserializeLengthDelimited(e,t);return null==t.reliable&&(t.reliable=!0),n},r.prototype.stopInternal=function(){null!=this.client&&this.client.readyState==WebSocket.OPEN&&(this.client.close(),this.client=null)};var a={VARINT:0,FIXED64:1,LENGTH_DELIMITED:2,FIXED32:5},l=function(e,t){this.field=e,this.wireType=t};function c(e,t){if(!e){if(t=t||"Assertion failed","undefined"!=typeof Error)throw new Error(t);throw t}}l.prototype={toString:function(){return"[Key: "+this.field+", "+this.wireType+"]"}};var h=function(){this.buffer="",this.position=0};h.prototype={getPosition:function(){return this.position},setPosition:function(e){this.position=e},getLength:function(){return this.buffer.length},bytesAvailable:function(){return this.buffer.length-this.position},readByte:function(){var e=this.readChar();return"number"==typeof e&&-1==e?0:e.charCodeAt(0)},readChar:function(){var e,t,n="";return e=(t=this.readChars(n,this.position,1))[0],n=t[1],1==e?n.slice(0,1):-1},readChars:function(e,t,n){if(c("string"==typeof e,"buffer must be string"),this.bytesAvailable()<=0)return console.log("WARNING: Reached end of the stream"),[0,e];if(n<=0)return console.log("WARNING: no characters read (length = 0)"),[0,e];var i;e.length>0?c(t>=0&&t<e.length,"position out of range"):t=0;var s,o="",r=this.position,a=r+n;return a>this.buffer.length&&(a=this.buffer.length),s=a-r,i=this.buffer.slice(r,a),this.position=a,0==t?(o=i,i.length<e.length&&(o+=e.slice(s))):(o=e.slice(0,t)+i,t+s+1<=e.length&&(o+=e.slice(t+s))),[s,o]},read:function(e,t,n){var s,o;c("object"===(void 0===e?"undefined":i(e))&&Array.isArray(e),"buffer must be array");for(var r="",a=[],l=0;l<e.length;l++)r+=String.fromCharCode(e[l]);o=(s=this.readChars(r,t,n))[0],r=s[1];for(l=0;l<r.length;l++)a.push(r.charCodeAt(l));return[o,a]},writeByte:function(e){c("number"==typeof e,"not valid byte"),c(e>=0&&e<=255,"not valid byte"),this.writeChar(String.fromCharCode(e))},writeChar:function(e){this.writeChars(e,0,1)},writeChars:function(e,t,n){if(c("string"==typeof e,"buffer must be string"),c(e&&e.length>0,"buffer must not be nil or empty"),this.bytesAvailable()<0)console.log("WARNING: Reached end of the stream");else{if(n<=0)return console.log("WARNING: no characters written (length = 0)"),[0,e];var i;c(t>=0&&t<e.length,"position out of range");var s,o="",r=t,a=r+n;a>e.length&&(a=e.length),s=a-r,i=e.slice(r,a),0==this.position?(o=i,this.buffer.length>i.length&&(o+=this.buffer.slice(s))):(o=this.buffer.slice(0,this.position)+i,this.position+s+1<=this.buffer.length&&(o+=this.buffer.slice(this.position+s))),this.buffer=o,this.position=this.position+s}},writeBytes:function(e,t,n){c("object"===(void 0===e?"undefined":i(e))&&Array.isArray(e),"buffer must be array");for(var s="",o=t;o<t+n&&!(o>=e.length);o++)s+=String.fromCharCode(e[o]);this.writeChars(s,0,n)},seek:function(e){this.position=this.position-e,this.position<0?this.position=0:this.position>=this.buffer.length&&(this.position=this.buffer.length-1)},toHex:function(){for(var e="",t=0;t<16*Math.ceil(this.buffer.length/16);t++){if(t%16==0){for(var n=(i=t.toString(16)).length;n<8;n++)e+="0";e=e+i+"  "}if(t>=this.buffer.length)e+="## ";else{for(n=(i=this.buffer.charCodeAt(t).toString(16)).length;n<2;n++)e+="0";e=e+i+" "}var i;if((t+1)%8==0&&(e+=" "),(t+1)%16==0)e=e+(i=this.buffer.slice(t-16+1,t+1)).replace("[^ -~]",".")+"\n"}return e},toString:function(){return this.buffer},getBuffer:function(){for(var e=[],t=0;t<this.buffer.length;t++)e.push(this.buffer.charCodeAt(t));return e}};var u=function(){this.tempBuffer=[],this.bytesRead=0,this.stream=null};u.prototype={wrap:function(e){this.bytesRead=0,this.stream=e},read:function(e,t,n){var i=this.stream.read(e,t,n);return this.bytesRead=this.bytesRead+i[0],i},readByte:function(){var e=this.read(this.tempBuffer,0,1);return 1==e[0]?(this.tempBuffer=e[1],this.tempBuffer[0]):-1},seek:function(e){for(var t=0;t<e;t++)this.readByte();return this.bytesRead},getLength:function(){return this.stream.getLength()},getPosition:function(){return this.bytesRead}};var p=function(){u.call(this),this.limit=0};(p.prototype=Object.create(u.prototype)).wrap=function(e,t){u.prototype.wrap.call(this,e),this.limit=t},p.prototype.read=function(e,t,n){var i;return i=n>this.limit-this.bytesRead?this.limit-this.bytesRead:n,u.prototype.read.call(this,e,t,i)},p.prototype.readByte=function(){return this.bytesRead>=this.limit?-1:u.prototype.readByte.call(this)},p.prototype.skipToEnd=function(){if(this.bytesRead<this.limit){for(var e=k.byteBufferPool.pop();256==this.read(e,this.bytesRead,256)[0];);k.byteBufferPool.push(e)}};var d={readBool:function(e){var t=e.readByte();return t<0?(console.log("WARNING: Stream ended too early"),!1):1==t||0!=t&&(print("WARNING: Invalid boolean value"),!1)},readUInt32:function(e){for(var t,n=0,i=0;i<=4;i++){if((t=e.readByte())<0)return console.log("WARNING: Stream ended too early"),0;if(4==i&&0!=(240&t))return console.log("WARNING: Got larger VarInt than 32bit unsigned"),0;if(0==(128&t))return n|t<<7*i;n|=(127&t)<<7*i}return console.log("WARNING: Got larger VarInt than 32bit unsigned"),0},readZInt32:function(e){var t=d.readUInt32(e);return t>>1^t<<31>>31},readSingle:function(e){for(var t,n=[],i=1;i<=4;i++)n[4-i]=e.readByte();t=n[0]<<24|n[1]<<16|n[2]<<8|n[3];var s,o=128==(128&n[0]),r=(2139095040&t)>>23,a=0;if(s=o?-1:1,255==r)c=o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;else if(0==r)c=0;else{r=r-127+1;for(var l=3;l>=2;l--)a+=n[l],a/=256;a=((a+=127&n[1])/128+1)/2;var c=s*Math.pow(2,r)*a}return c},readUInt64:function(e){for(var t,n=0,i=0;i<=9;i++){if((t=e.readByte())<0)return console.log("WARNING: Stream ended too early"),0;if(9==i&&0!=(254&t))return console.log("WARNING: Got larger VarInt than 64 bit unsigned"),0;if(0==(128&t))return n+t*Math.pow(128,i);n+=(127&t)*Math.pow(128,i)}return console.log("WARNING: Got larger VarInt than 64 bit unsigned"),0},readZInt64:function(e){var t=d.readUInt64(e);return t%2==1?Math.floor(-t/2):Math.floor(t/2)},readDouble:function(e){for(var t,n=[],i=1;i<=8;i++)n[8-i]=e.readByte();t=n[0]<<24|n[1]<<16;var s,o=128==(128&n[0]),r=(2146435072&t)>>20,a=0;if(s=o?-1:1,2047==r)c=o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;else if(0==r)c=0;else{r=r-1023+1;for(var l=7;l>=2;l--)a+=n[l],a/=256;a=((a+=15&n[1])/16+1)/2;var c=s*Math.pow(2,r)*a}return c},readString:function(e){for(var t,n,i=d.readUInt32(e),s=k.memoryStreamPool.pop(),o=k.byteBufferPool.pop(),r=0;r<i;){if(n=(t=e.read(o,0,Math.min(i-r,o.length)))[0],o=t[1],0==n)return console.log("WARNING: Expected "+(i-r).toString()+" got "+r),0;s.writeBytes(o,0,n),r+=n}return t=s.toString().slice(0,s.getPosition()),k.byteBufferPool.push(o),k.memoryStreamPool.push(s),t},readKey:function(e,t){if(e<128)return new l(e>>3,7&e);var n=d.readUInt32(t)<<4|e>>3&15;return new l(n,7&e)},skipKey:function(e,t){t.wireType==a.FIXED32?e.seek(4):t.wireType==a.FIXED64?e.seek(8):t.wireType==a.LENGTH_DELIMITED?e.seek(d.readUInt32(e)):t.wireType==a.VARINT?d.readSkipVarInt(e):console.log("WARNING: Unknown wire type: "+t.wireType)},readSkipVarInt:function(e){for(;;){var t=e.readByte();if(t<0)return void console.log("WARNING: Stream ended too early");if(0==(128&t))return}},writeBool:function(e,t){return t?e.writeByte(1):e.writeByte(0)},writeUInt32:function(e,t){var n;for(t=Math.abs(t);;){if(n=127&t,0==(t>>>=7)){e.writeByte(n);break}n|=128,e.writeByte(n)}},writeZInt32:function(e,t){var n=t<<1,i=t>>31;d.writeUInt32(e,n^i)},writeUInt64:function(e,t){var n;for(t=Math.abs(t);;){if(n=127&t,0==(t=Math.floor(t/128))){e.writeByte(n);break}n|=128,e.writeByte(n)}},writeZInt64:function(e,t){var n=!1;t<0&&(t=-(t+=1),n=!0),t*=2,1==n&&(t+=1),d.writeUInt64(e,t)},frexp:function(e){var t=[e=Number(e),0];if(0!==e&&Number.isFinite(e)){for(var n=Math.abs(e),i=Math.log2||function(e){return Math.log(e)*Math.LOG2E},s=Math.max(-1023,Math.floor(i(n))+1),o=n*Math.pow(2,-s);o<.5;)o*=2,s--;for(;o>=1;)o*=.5,s++;e<0&&(o=-o),t[0]=o,t[1]=s}return t},writeSingle:function(e,t){var n=[0,0,0,0];if(0!=t){var i=Math.abs(t),s=d.frexp(i),o=s[0],r=s[1],a=t!=i?128:0;(o=2*o-1)==1/0?(o=0,r=255):(r-=1,((r+=127)<0||r>=255)&&(o=0,r=r<0?0:255)),n[0]=a+(r>>1),o*=128;var l=Math.floor(o);o-=l,n[1]=((1&r)<<7)+l;for(var c=2;c<4;c++)o*=256,o-=l=Math.floor(o),n[c]=l}for(c=n.length-1;c>=0;c--)e.writeByte(n[c])},writeDouble:function(e,t){var n=[0,0,0,0,0,0,0,0];if(0!=t){var i=Math.abs(t),s=d.frexp(i),o=s[0],r=s[1],a=t!=i?128:0;(o=2*o-1)==1/0?(o=0,r=2047):(r-=1,((r+=1023)<0||r>=2047)&&(o=0,r=r<0?0:2047)),n[0]=a+(r>>4),o*=16;var l=Math.floor(o);o-=l,n[1]=((15&r)<<4)+l;for(var c=2;c<8;c++)o*=256,o-=l=Math.floor(o),n[c]=l}for(c=n.length-1;c>=0;c--)e.writeByte(n[c])},writeBytes:function(e,t,n){d.writeUInt32(e,n),e.writeBytes(t,0,n)},writeString:function(e,t){for(var n=[],i=0;i<t.length;i++)n.push(t.charCodeAt(i));d.writeBytes(e,n,t.length)}},g=function(e,t,n){this.stack=[],this.creator=e,this.refresher=t,this.maxSize=n};g.prototype={pop:function(){return 0==this.stack.length?this.creator():this.stack.shift()},push:function(e){if(e){if(this.stack.indexOf(e)>=0)return;this.stack.length<this.maxSize&&(this.refresher&&this.refresher(e),this.stack.push(e))}},dispose:function(){this.stack=[]}};var f=function(){this.tag=null,this.msg=null,this.level=null,this.session=null};f.pool=new g(function(){return new f},null,5),f.prototype={configure:function(e,t,n,i){return this.tag=t,this.msg=i,this.level=n,this.session=e,this},execute:function(){G.shouldLog(this.tag,this.level)&&(this.session.peerId?G.logger(this.session.peerId+" "+this.tag+":"+this.msg):G.logger(" "+this.tag+":"+this.msg)),f.pool.push(this)}};var y=function(){this.session=null,this.opCode=0,this.sender=0,this.limit=0,this.packetSize=0,this.ms=null,this.limitedStream=null,this.data=null};y.pool=new g(function(){return new y},null,5),y.prototype={configure:function(e,t,n,i,s,o,r){if(this.ms=k.memoryStreamPool.pop(),this.packetSize=r,this.opCode=e,this.sender=t,this.data=i,this.session=o,this.limit=s,this.limitedStream=null,null!=n){this.limitedStream=k.limitedPositionStreamPool.pop();for(var a=1;a<=s;a++){var l=n.readByte();this.ms.writeByte(l)}this.ms.setPosition(0),this.limitedStream.wrap(this.ms,s)}return this},execute:function(){this.session.onPacket(new O(this.opCode,this.sender,this.limitedStream,this.limit,this.data,this.packetSize)),k.memoryStreamPool.push(this.ms),k.limitedPositionStreamPool.push(this.limitedStream),y.pool.push(this)}};var v=function(){this.action=null};v.pool=new g(function(){return new v},null,5),v.prototype={configure:function(e){return this.action=e,this},execute:function(){this.action(),v.pool.push(this)}};var m={getCommand:function(e,t,n,i,o,r,a){var l=null,c=d.readUInt32(i),h=k.limitedPositionStreamPool.pop();return h.wrap(i,c),e==s.LOGIN_RESULT?l=E.deserialize(h,E.pool.pop()):e==s.PING_RESULT?l=R.deserialize(h,R.pool.pop()):e==s.UDP_CONNECT_MESSAGE?l=_.deserialize(h,_.pool.pop()):e==s.PLAYER_CONNECT_MESSAGE?l=b.deserialize(h,b.pool.pop()):e==s.PLAYER_DISCONNECT_MESSAGE?l=w.deserialize(h,w.pool.pop()):o.shouldExecute(t,n)&&(l=y.pool.pop().configure(e,t,h,r,c,o,a)),h.skipToEnd(),k.limitedPositionStreamPool.push(h),l}},S=function(){this.abstractResultType=!0,this.packet=null,this.session=null};S.prototype={configure:function(e,t){this.packet=e,this.session=t},executeAsync:function(){return!0}};var E=function(){S.call(this),this.success=!1,this.reconnectToken=null,this.peerId=null,this.activePeers=[],this.fastPort=null};E.pool=new g(function(){return new E},function(e){e.activePeers=[],e.fastPort=null,e.reconnectToken=null,e.peerId=null},5),E.prototype=Object.create(S.prototype),E.prototype.execute=function(){this.session.connectToken=this.reconnectToken,this.session.peerId=this.peerId,null==this.packet.reliable||1==this.packet.reliable?(null!=this.fastPort&&this.fastPort&&(this.session.fastPort=this.fastPort),this.session.activePeers=this.activePeers.slice(),this.session.setConnectState(G.connectState.RELIABLE_ONLY),this.session.connectFast(),this.session.log("LoginResult",G.logLevel.DEBUG,this.session.peerId+" TCP LoginResult, ActivePeers "+this.session.activePeers.length)):this.session.setConnectState(G.connectState.RELIABLE_AND_FAST_SEND),E.pool.push(this)},E.prototype.executeAsync=function(){return!1},E.deserialize=function(e,t){for(null==t.activePeers&&(t.activePeers=[]);;){var n=e.readByte();if(-1==n)break;var i=!1;if(8==n?(t.success=d.readBool(e),i=!0):18==n?(t.reconnectToken=d.readString(e),i=!0):24==n?(t.peerId=d.readUInt64(e),i=!0):32==n?(t.activePeers.push(d.readUInt64(e)),i=!0):40==n&&(t.fastPort=d.readUInt64(e),i=!0),!i){var s=d.readKey(n,e);if(0==s.field)return console.log("WARNING: Invalid field id: 0, something went wrong in the stream"),null;d.skipKey(e,s)}}return t};var R=function(){S.call(this)};R.pool=new g(function(){return new R},null,5),R.prototype=Object.create(S.prototype),R.prototype.execute=function(){this.session.log("PingResult",G.LogLevel.DEBUG,""),R.pool.push(this)},R.prototype.executeAsync=function(){return!1},R.deserialize=function(e,t){for(;;){var n=e.readByte();if(-1==n)break;var i=d.readKey(n,e);if(0==i.field)return console.log("WARNING: Invalid field id: 0, something went wrong in the stream"),null;d.skipKey(e,i)}return t};var b=function(){S.call(this),this.peerId=0,this.activePeers=[]};b.pool=new g(function(){return new b},function(e){e.activePeers=[]},5),b.prototype=Object.create(S.prototype),b.prototype.execute=function(){this.session.activePeers=[],this.session.activePeers=this.activePeers.slice(),this.session.log("PlayerConnectMessage",G.logLevel.DEBUG,"PeerId="+this.peerId+", ActivePeers "+this.session.activePeers.length),this.session.onPlayerConnect(this.peerId),b.pool.push(this)},b.deserialize=function(e,t){for(null==t.activePeers&&(t.activePeers=[]);;){var n=e.readByte();if(-1==n)break;var i=!1;if(8==n?(t.peerId=d.readUInt64(e),i=!0):32==n&&(t.activePeers.push(d.readUInt64(e)),i=!0),!i){var s=d.readKey(n,e);if(0==s.field)return console.log("WARNING: Invalid field id: 0, something went wrong in the stream"),null;d.skipKey(e,s)}}return t};var w=function(){S.call(this),this.peerId=0,this.activePeers=[]};w.pool=new g(function(){return new w},function(e){e.activePeers=[]},5),w.prototype=Object.create(S.prototype),w.prototype.execute=function(){this.session.activePeers=[],this.session.activePeers=this.activePeers.slice(),this.session.log("PlayerDisconnectMessage",G.logLevel.DEBUG,"PeerId="+this.peerId+", ActivePeers "+this.session.activePeers.length),this.session.onPlayerDisconnect(this.peerId),w.pool.push(this)},w.deserialize=function(e,t){for(null==t.activePeers&&(t.activePeers=[]);;){var n=e.readByte();if(-1==n)break;var i=!1;if(8==n?(t.peerId=d.readUInt64(e),i=!0):32==n&&(t.activePeers.push(d.readUInt64(e)),i=!0),!i){var s=d.readKey(n,e);if(0==s.field)return console.log("WARNING: Invalid field id: 0, something went wrong in the stream"),null;d.skipKey(e,s)}}return t};var _=function(){S.call(this)};_.pool=new g(function(){return new _},null,5),_.prototype=Object.create(S.prototype),_.prototype.execute=function(){var e;e=null!=this.packet.reliable&&this.packet.reliable,this.session.log("UDPConnectMessage",G.logLevel.DEBUG,"(UDP) reliable="+e.toString()+", ActivePeers "+this.session.activePeers.length),e?self.session.log("UDPConnectMessage",G.logLevel.DEBUG,"TCP (Unexpected) UDPConnectMessage"):(self.session.setConnectState(G.connectState.RELIABLE_AND_FAST),self.session.sendData(-5,G.deliveryIntent.RELIABLE,null,null)),_.pool.push(this)},_.prototype.executeAsync=function(){return!1},_.deserialize=function(e,t){for(;;){var n=e.readByte();if(-1==n)break;var i=d.readKey(n,e);if(0==i.field)return console.log("WARNING: Invalid field id: 0, something went wrong in the stream"),null;d.skipKey(e,i)}return t};var I=function(){this.data=null,this.opCode=0,this.targetPlayers=[],this.intent=G.deliveryIntent.RELIABLE};I.prototype={toPacket:function(e,t){return null},reset:function(){this.targetPlayers=[]},serialize:function(e){}};var T=function(e){I.call(this),this.opCode=0,this.token=e,this.clientVersion=2};T.prototype=Object.create(I.prototype),T.prototype.toPacket=function(e,t){var n=k.packetPool.pop();return n.opCode=this.opCode,n.data=this.data,n.session=e,t||this.intent==G.deliveryIntent.RELIABLE||(n.reliable=!1),this.intent==G.deliveryIntent.UNRELIABLE_SEQUENCED&&(n.sequenceNumber=e.nextSequenceNumber()),this.targetPlayers.length>0&&(n.targetPlayers=this.targetPlayers),n.request=this,n},T.prototype.serialize=function(e){null!=this.token&&(e.writeByte(10),d.writeString(e,this.token)),null!=this.clientVersion&&(e.writeByte(16),d.writeUInt64(e,this.clientVersion))};var P=function(e){I.call(this),this.opCode=-2};(P.prototype=Object.create(I.prototype)).toPacket=function(e,t){var n=k.packetPool.pop();return n.opCode=this.opCode,n.data=this.data,n.session=e,t||this.intent==G.deliveryIntent.RELIABLE||(n.reliable=!1),this.intent==G.deliveryIntent.UNRELIABLE_SEQUENCED&&(n.sequenceNumber=e.nextSequenceNumber()),this.targetPlayers.length>0&&(n.targetPlayers=this.targetPlayers),n.request=this,n},P.prototype.serialize=function(e){};var C=function(){I.call(this),this.payload=null};(C.prototype=Object.create(I.prototype)).configure=function(e,t,n,i,s){if(this.opCode=e,this.payload=n,this.intent=t,this.data=i,null!=s)for(var o in s)this.targetPlayers.push(s[o])},C.prototype.toPacket=function(e,t){var n=k.packetPool.pop();return n.opCode=this.opCode,n.data=this.data,n.session=e,t||this.intent==G.deliveryIntent.RELIABLE||(n.reliable=!1),this.intent==G.deliveryIntent.UNRELIABLE_SEQUENCED&&(n.sequenceNumber=e.nextSequenceNumber()),this.targetPlayers.length>0&&(n.targetPlayers=this.targetPlayers),n.request=this,n},C.prototype.serialize=function(e){this.payload&&e.writeBytes(this.payload,0,this.payload.length)},C.prototype.reset=function(){this.payload=null,I.prototype.reset.call(this)};var N=function(){this.opCode=0,this.sequenceNumber=null,this.requestId=null,this.targetPlayers=null,this.sender=null,this.reliable=null,this.data=null,this.payload=null,this.request=null,this.hasPayload=!1,this.command=null,this.session=null};N.prototype={reset:function(){this.opCode=0,this.sequenceNumber=null,this.requestId=null,this.targetPlayers=null,this.sender=null,this.reliable=null,this.payload=null,this.command=null,this.request=null,this.hasPayload=!1,this.data=null},toString:function(){return"{OpCode:"+this.opCode+",TargetPlayers:"+this.targetToString()+"}"},targetToString:function(){var e="[";if(null!=this.targetPlayers)for(var t=0;t<this.targetPlayers.length;t++)e=e+this.targetPlayers[t]+" ";return e+"]"},readPayload:function(e,t){return this.hasPayload=!0,null!=this.sender?this.command=m.getCommand(this.opCode,this.sender,this.sequenceNumber,e,this.session,this.data,t):this.command=m.getCommand(this.opCode,0,this.sequenceNumber,e,this.session,this.data,t),null},writePayload:function(e){if(null!=this.request){var t=k.memoryStreamPool.pop();this.request.serialize(t);var n=t.getBuffer();t.getPosition()>0&&(e.writeByte(122),d.writeBytes(e,n,t.getPosition())),k.memoryStreamPool.push(t)}else null!=this.payload&&(e.writeByte(122),d.writeBytes(e,this.payload,this.payload.length))}},N.serialize=function(e,t){if(e.writeByte(8),d.writeZInt32(e,t.opCode),null!=t.sequenceNumber&&(e.writeByte(16),d.writeUInt64(e,t.sequenceNumber)),null!=t.requestId&&(e.writeByte(24),d.writeUInt64(e,t.requestId)),null!=t.targetPlayers)for(var n=0;n<t.targetPlayers.length;n++)e.writeByte(32),d.writeUInt64(e,t.targetPlayers[n]);return null!=t.sender&&(e.writeByte(40),d.writeUInt64(e,t.sender)),null!=t.reliable&&(e.writeByte(48),d.writeBool(e,t.reliable)),null!=t.data&&(e.writeByte(114),M.writeRTData(e,t.data)),t.writePayload(e),e},N.serializeLengthDelimited=function(e,t){var n,i=k.memoryStreamPool.pop();N.serialize(i,t);var s=i.getBuffer();return d.writeBytes(e,s,i.getPosition()),n=i.getPosition(),k.memoryStreamPool.push(i),n},N.deserializeLengthDelimited=function(e,t){var n=d.readUInt32(e),i=n;for(n+=e.getPosition();;){if(e.getPosition()>=n){if(e.getPosition()==n)break;return console.log("WARNING: Read past max limit"),0}var s=e.readByte();if(-1==s)return console.log("WARNING: End of stream"),0;var o=!1;if(8==s?(t.opCode=d.readZInt32(e),o=!0):16==s?(t.sequenceNumber=d.readUInt64(e),o=!0):24==s?(t.requestId=d.readUInt64(e),o=!0):40==s?(t.sender=d.readUInt64(e),o=!0):48==s?(t.reliable=d.readBool(e),o=!0):114==s?(null==t.data?t.data=M.readRTData(e,t.data):M.readRTData(e,t.data),o=!0):122==s&&(t.payload=t.readPayload(e,i),o=!0),!o){var r=d.readKey(s,e);if(0==r.field)return console.log("WARNING: Invalid field id: 0, something went wrong in the stream"),0;d.skipKey(e,r)}}return i};var k={};k.packetPool=new g(function(){return new N},function(e){e.reset()},5),k.memoryStreamPool=new g(function(){return new h},function(e){e.setPosition(0)},5),k.positionStreamPool={},k.limitedPositionStreamPool=new g(function(){return new p},null,5),k.byteBufferPool=new g(function(){for(var e=[],t=0;t<256;t++)e.push(0);return e},null,5),k.customRequestPool=new g(function(){return new C},function(e){e.reset()},5);var L={};L.cache=new g(function(){return new M},function(e){for(var t=0;t<e.data.length;t++)e.data[t].data_val&&e.data[t].data_val.dispose(),e.data[t].reset()},5),L.get=function(){return L.cache.pop()},L.readRTData=function(e,t){null==t&&(t=L.cache.pop());var n=d.readUInt32(e);for(n+=e.getPosition();;){if(e.getPosition()>=n){if(e.getPosition()==n)break;return console.log("WARNING: Read past max limit"),null}var i=e.readByte();if(-1==i)break;var s=d.readKey(i,e);if(s.wireType==a.VARINT?t.data[s.field]=D.newLong(d.readZInt64(e)):s.wireType==a.FIXED32?t.data[s.field]=D.newFloat(d.readSingle(e)):s.wireType==a.FIXED64?t.data[s.field]=D.newDouble(d.readDouble(e)):s.wireType==a.LENGTH_DELIMITED&&(t.data[s.field]=D.deserializeLengthDelimited(e)),0==s.field)return console.log("WARNING: Invalid field id: 0, something went wrong in the stream"),null}return t},L.writeRTData=function(e,t){for(var n=k.memoryStreamPool.pop(),i=1;i<t.data.length;i++){var s=t.data[i];null!=s.long_val?(d.writeUInt32(n,i<<3),d.writeZInt64(n,s.long_val)):null!=s.float_val?(d.writeUInt32(n,i<<3|5),d.writeSingle(n,s.float_val)):null!=s.double_val?(d.writeUInt32(n,i<<3|1),d.writeDouble(n,s.double_val)):(s.data_val||s.string_val||s.vec_val)&&(d.writeUInt32(n,i<<3|2),s.serializeLengthDelimited(n))}var o=n.getBuffer();d.writeBytes(e,o,n.getPosition()),k.memoryStreamPool.push(n)};var A=function(e,t,n,i){this.x=e,this.y=t,this.z=n,this.w=i};A.prototype={};var D=function(){this.long_val=null,this.float_val=null,this.double_val=null,this.data_val=null,this.string_val=null,this.vec_val=null};D.prototype={serializeLengthDelimited:function(e){var t=k.memoryStreamPool.pop();if(this.string_val)t.writeByte(10),d.writeString(t,this.string_val);else if(this.data_val)t.writeByte(114),M.writeRTData(t,this.data_val);else if(this.vec_val){var n=this.vec_val,i=0;t.writeByte(18),null!=n.x&&(i+=1),null!=n.y&&(i+=1),null!=n.z&&(i+=1),null!=n.w&&(i+=1),d.writeUInt32(t,4*i);for(var s=1;s<=i;s++)1==s?d.writeSingle(t,n.x):2==s?d.writeSingle(t,n.y):3==s?d.writeSingle(t,n.z):4==s&&d.writeSingle(t,n.w)}var o=t.getBuffer();d.writeBytes(e,o,t.getPosition()),k.memoryStreamPool.push(t)},reset:function(){this.data_val&&this.data_val.dispose(),this.long_val=null,this.float_val=null,this.double_val=null,this.data_val=null,this.string_val=null,this.vec_val=null},dirty:function(){return null!=this.long_val||(null!=this.float_val||(null!=this.double_val||(!!this.data_val||(!!this.string_val||!!this.vec_val))))},asString:function(){if(null!=this.long_val)return this.long_val.toString();if(null!=this.float_val)return this.float_val.toString();if(null!=this.double_val)return this.double_val.toString();if(this.data_val)return this.data_val.toString();if(this.string_val)return'"'+this.string_val+'"';if(this.vec_val){var e="|";return null!=this.vec_val.x&&(e=e+this.vec_val.x.toString()+"|"),null!=this.vec_val.y&&(e=e+this.vec_val.y.toString()+"|"),null!=this.vec_val.z&&(e=e+this.vec_val.z.toString()+"|"),null!=this.vec_val.w&&(e=e+this.vec_val.w.toString()+"|"),e}return null}},D.newLong=function(e){var t=new D;return t.long_val=e,t},D.newFloat=function(e){var t=new D;return t.float_val=e,t},D.newDouble=function(e){var t=new D;return t.double_val=e,t},D.newRTData=function(e){var t=new D;return t.data_val=e,t},D.newString=function(e){var t=new D;return t.string_val=e,t},D.newRTVector=function(e){var t=new D;return t.vec_val=e,t},D.deserializeLengthDelimited=function(e){var t=new D,n=d.readUInt32(e);for(n+=e.getPosition();;){if(e.getPosition()>=n){if(e.getPosition()==n)break;return console.log("WARNING: Read past max limit"),0}var i=e.readByte();if(-1==i)return console.log("WARNING: End of stream"),0;var s=!1;if(10==i)t.string_val=d.readString(e),s=!0;else if(18==i){var o=d.readUInt32(e);o+=e.getPosition();for(var r=new A,a=0;e.getPosition()<o;){var l=d.readSingle(e);0==a?r.x=l:1==a?r.y=l:2==a?r.z=l:3==a&&(r.w=l),a+=1}if(t.vec_val=r,e.getPosition()!=o)return console.log("WARNING: Read too many bytes in packed data"),null;s=!0}else 114==i&&(null==t.data_val&&(t.data_val=L.cache.pop()),M.readRTData(e,t.data_val),s=!0);if(!s){var c=d.readKey(i,e);if(0==c.field)return console.log("WARNING: Invalid field id: 0, something went wrong in the stream"),null;d.skipKey(e,c)}}return t};var M=function(){this.data=[];for(var e=0;e<G.MAX_RTDATA_SLOTS;e++)this.data.push(new D)};M.get=function(){return L.cache.pop()},M.readRTData=function(e,t){return L.readRTData(e,t)},M.writeRTData=function(e,t){L.writeRTData(e,t)},M.prototype={dispose:function(){for(var e=0;e<this.data.length;e++)this.data[e].dirty()&&(this.data[e]=new D);L.cache.push(this)},getRTVector:function(e){return this.data[e].vec_val},getLong:function(e){return this.data[e].long_val},getFloat:function(e){return this.data[e].float_val},getDouble:function(e){return this.data[e].double_val},getString:function(e){return this.data[e].string_val},getData:function(e){return this.data[e].data_val},setRTVector:function(e,t){return this.data[e]=D.newRTVector(t),this},setLong:function(e,t){return isFinite(t)?this.data[e]=D.newLong(t):console.error("Not a valid number error"),this},setFloat:function(e,t){return isFinite(t)?this.data[e]=D.newFloat(t):console.error("Not a valid number error"),this},setDouble:function(e,t){return isFinite(t)?this.data[e]=D.newDouble(t):console.error("Not a valid number error"),this},setString:function(e,t){return this.data[e]=D.newString(t),this},setData:function(e,t){return this.data[e]=D.newRTData(t),this},toString:function(){return this.asString()},asString:function(){for(var e=" {",t=0;t<G.MAX_RTDATA_SLOTS;t++){var n=this.data[t].asString();null!=n&&(e=e+" ["+t.toString()+" "+n+"] ")}return e+="} "}};var O=function(e,t,n,i,s,o){this.opCode=e,this.sender=t,this.stream=n,this.streamLength=i,this.data=s,this.packetSize=o};O.prototype={toString:function(){var e="OpCode="+this.opCode+",Sender="+this.sender+",streamExists=";return null!=this.stream?e=e+"true,StreamLength="+this.streamLength:e+="false",e+=",Data=",null!=this.data?e+=this.data.toString():e=e+".PacketSize="+this.packetSize,e}};var B=function(e,t,n,i){this.connectToken=e,this.tcpPort=n,this.fastPort=n,this.hostName=t,this.activePeers=[],this.running=!1,this.ready=!1,this.actionQueue=[],this.connectState=G.connectState.DISCONNECTED,this.mustConnnectBy=(new Date).getTime(),this.reliableConnection=null,this.sequenceNumber=0,this.peerId=null,this.peerMaxSequenceNumbers=[],this.listener=i};B.prototype={start:function(){this.running=!0},stop:function(){this.log("IRTSession",G.logLevel.DEBUG,"Stopped"),this.running=!1,this.ready=!1,this.reliableConnection&&this.reliableConnection.stop(),this.setConnectState(G.connectState.DISCONNECTED)},update:function(){this.running&&this.checkConnection();for(var e=null;e=this.getNextAction();)e.execute()},getNextAction:function(){return this.actionQueue.length>0?this.actionQueue.shift():null},submitAction:function(e){this.actionQueue.push(e)},checkConnection:function(){this.connectState==G.connectState.DISCONNECTED?(this.log("IRTSession",G.logLevel.INFO,"Disconnected, trying to connect"),this.setConnectState(G.connectState.CONNECTING),this.connectReliable()):this.connectState==G.connectState.CONNECTING&&(new Date).getTime()>this.mustConnnectBy&&(this.setConnectState(G.connectState.DISCONNECTED),this.log("IRTSession",G.logLevel.INFO,"Not connected in time, retrying"),this.reliableConnection&&(this.reliableConnection.stopInternal(),this.reliableConnection=null))},setConnectState:function(e){e!=G.connectState.RELIABLE_AND_FAST_SEND&&e!=G.connectState.RELIABLE_AND_FAST||(e=G.connectState.RELIABLE_ONLY),e!=this.connectState&&(this.connectState<e||e==G.connectState.DISCONNECTED)&&(this.log("IRTSession",G.logLevel.DEBUG,"State Change : from "+this.connectState+" to "+e+", ActivePeers "+this.activePeers.length),this.connectState=e,e==G.connectState.RELIABLE_ONLY&&this.onReady(!0))},connectFast:function(){},connectReliable:function(){this.mustConnnectBy=(new Date).getTime()+1e3*G.TCP_CONNECT_TIMEOUT_SECONDS,this.reliableConnection=new r(this.hostName,this.tcpPort,this),this.reliableConnection.connect()},nextSequenceNumber:function(){var e=this.sequenceNumber;return this.sequenceNumber=this.sequenceNumber+1,e},shouldExecute:function(e,t){return null==t||(null==this.peerMaxSequenceNumbers[e]&&(this.peerMaxSequenceNumbers[e]=0),this.peerMaxSequenceNumbers[e]>t?(this.log("IRTSession",G.logLevel.DEBUG,"Discarding sequence id "+t+" from peer "+e.toString()),!1):(this.peerMaxSequenceNumbers[e]=t,!0))},resetSequenceForPeer:function(e){this.peerMaxSequenceNumbers[e]&&(this.peerMaxSequenceNumbers[e]=0)},onPlayerConnect:function(e){this.resetSequenceForPeer(e),this.listener&&this.ready&&this.listener.onPlayerConnect(e)},onPlayerDisconnect:function(e){this.listener&&this.ready&&this.listener.onPlayerDisconnect(e)},onReady:function(e){if(!this.ready&&e&&(this.sendData(s.PLAYER_READY_MESSAGE,G.deliveryIntent.RELIABLE,null,null),this.peerId)){var t=!1;for(var n in this.activePeers)if(this.activePeers[n]==this.peerId){t=!0;break}t||this.activePeers.push(this.peerId)}if(this.ready=e,this.ready||this.setConnectState(G.connectState.DISCONNECTED),this.listener){var i=this.listener;this.submitAction(v.pool.pop().configure(function(){i.onReady(e)}))}},onPacket:function(e){if(!this.listener)throw new Error("AccessViolationException");this.listener.onPacket(e)},sendData:function(e,t,n,i,s){return this.sendRTDataAndBytes(e,t,n,i,s)},sendRTData:function(e,t,n,i){return this.sendRTDataAndBytes(e,t,null,n,i)},sendBytes:function(e,t,n,i){return this.sendRTDataAndBytes(e,t,n,null,i)},sendRTDataAndBytes:function(e,t,n,i,s){var o,r=k.customRequestPool.pop();return r.configure(e,t,n,i,s),this.connectState>=G.connectState.RELIABLE_ONLY?(o=this.reliableConnection.send(r),k.customRequestPool.push(r),o):(k.customRequestPool.push(r),0)},log:function(e,t,n){G.shouldLog(e,t)&&this.submitAction(f.pool.pop().configure(this,e,t,n))}};var G=function(){};G.MAX_RTDATA_SLOTS=128,G.TCP_CONNECT_TIMEOUT_SECONDS=5,G.logLevel={},G.logLevel.DEBUG=0,G.logLevel.INFO=1,G.logLevel.WARN=2,G.logLevel.ERROR=3,G.connectState={},G.connectState.DISCONNECTED=0,G.connectState.CONNECTING=1,G.connectState.RELIABLE_ONLY=2,G.connectState.RELIABLE_AND_FAST_SEND=3,G.connectState.RELIABLE_AND_FAST=4,G.deliveryIntent={},G.deliveryIntent.RELIABLE=0,G.deliveryIntent.UNRELIABLE=1,G.deliveryIntent.UNRELIABLE_SEQUENCED=2,G.currLogLevel=G.logLevel.INFO,G.tagLevels={},G.logger=function(e){console.log(e)},G.getSession=function(e,t,n,i){return new B(e,t,n,i)},G.setRootLogLevel=function(e){G.currLogLevel=e},G.setLogLevel=function(e,t){G.tagLevels[e]=t},G.shouldLog=function(e,t){for(var n in G.tagLevels){var i=G.tagLevels[n];if(n==e)return i>=t}return G.currLogLevel<=t},G.prototype={},t.exports={GameSparksRT:G,RTData:M},cc._RF.pop()},{}],gamesparks:[function(e,t,n){"use strict";cc._RF.push(t,"e9e65w6IZhM/4gufPhsvqan","gamesparks");var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=e("hmac-sha256");(function(e,n){"function"==typeof define&&define.amd?define(["crypto-js","ws"],n):"object"===(void 0===t?"undefined":i(t))&&t.exports?t.exports=n(s,WebSocket||MozWebSocket):e.GameSparks=n(e.CryptoJS,e.WebSocket||e.MozWebSocket)})(void 0,function(e,t){var n=function(){};return n.prototype={init:function(e){this.options=e,this.socketUrl=e.url,this.pendingRequests={},this.requestCounter=0,this.connect()},buildServiceUrl:function(e,t){var n,i,s,o=t.key;return n=e?"live":"preview",i=t.credential&&0!==t.credential.length?t.credential:"device",t.secret&&(s=t.secret.indexOf(":"))>0&&(i="secure",o=t.secret.substr(0,s)+"/"+o),"wss://"+n+"-"+o+".ws.gamesparks.net/ws/"+i+"/"+o},initPreview:function(e){e.url=this.buildServiceUrl(!1,e),this.init(e)},initLive:function(e){e.url=this.buildServiceUrl(!0,e),this.init(e)},reset:function(){this.initialised=!1,this.connected=!1,this.error=!1,this.disconnected=!1,null!=this.webSocket&&(this.webSocket.onclose=null,this.webSocket.close())},connect:function(){this.reset();try{this.webSocket=new t(this.socketUrl),this.webSocket.onopen=this.onWebSocketOpen.bind(this),this.webSocket.onclose=this.onWebSocketClose.bind(this),this.webSocket.onerror=this.onWebSocketError.bind(this),this.webSocket.onmessage=this.onWebSocketMessage.bind(this)}catch(e){this.log(e.message)}},disconnect:function(){this.webSocket&&this.connected&&(this.disconnected=!0,this.webSocket.close())},onWebSocketOpen:function(e){this.log("WebSocket onOpen"),this.options.onOpen&&this.options.onOpen(e),this.connected=!0},onWebSocketClose:function(e){this.log("WebSocket onClose"),this.options.onClose&&this.options.onClose(e),this.connected=!1,this.error||this.disconnected||this.connect()},onWebSocketError:function(e){this.log("WebSocket onError: Sorry, but there is some problem with your socket or the server is down"),this.options.onError&&this.options.onError(e),this.socketUrl=this.options.url,this.error=!0},onWebSocketMessage:function(e){var t;this.log("WebSocket onMessage: "+e.data);try{t=JSON.parse(e.data)}catch(t){return void this.log("An error ocurred while parsing the JSON Data: "+e+"; Error: "+t)}this.options.onMessage&&this.options.onMessage(t),t.authToken&&(this.authToken=t.authToken,delete t.authToken),t.connectUrl&&(this.socketUrl=t.connectUrl,this.connect());var n=t["@class"];if(".AuthenticatedConnectResponse"===n)this.handshake(t);else if(n.match(/Response$/)&&t.requestId){var i=t.requestId;delete t.requestId,this.pendingRequests[i]&&(this.pendingRequests[i](t),this.pendingRequests[i]=null)}},handshake:function(t){if(t.nonce){var n;this.options.onNonce?n=this.options.onNonce(t.nonce):this.options.secret&&(n=e.enc.Base64.stringify(e.HmacSHA256(t.nonce,this.options.secret)));var i={"@class":".AuthenticatedConnectRequest",hmac:n};this.authToken&&(i.authToken=this.authToken),this.sessionId&&(i.sessionId=this.sessionId);var s=this.getBrowserData();i.platform=s.browser,i.os=s.operatingSystem,this.webSocketSend(i)}else t.sessionId&&(this.sessionId=t.sessionId,this.initialised=!0,this.options.onInit&&this.options.onInit(),this.keepAliveInterval=window.setInterval(this.keepAlive.bind(this),3e4))},keepAlive:function(){this.initialised&&this.connected&&this.webSocket.send(" ")},send:function(e,t){this.sendWithData(e,{},t)},sendWithData:function(e,t,n){this.initialised?(0!==e.indexOf(".")&&(e="."+e),t["@class"]=e,t.requestId=(new Date).getTime()+"_"+ ++this.requestCounter,null!=n&&(this.pendingRequests[t.requestId]=n,setTimeout(function(){this.pendingRequests[t.requestId]&&this.pendingRequests[t.requestId]({error:"NO_RESPONSE"})}.bind(this),32e3)),this.webSocketSend(t)):n({error:"NOT_INITIALISED"})},webSocketSend:function(e){this.options.onSend&&this.options.onSend(e);var t=JSON.stringify(e);this.log("WebSocket send: "+t),this.webSocket.send(t)},getSocketUrl:function(){return this.socketUrl},getSessionId:function(){return this.sessionId},getAuthToken:function(){return this.authToken},setAuthToken:function(e){this.authToken=e},isConnected:function(){return this.connected},log:function(e){this.options.logger&&this.options.logger(e)},getBrowserData:function(){var e=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],t=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}];function n(e){for(var t=0;t<e.length;t++){var n=e[t].string,i=e[t].prop;if(n){if(-1!==n.indexOf(e[t].subString))return e[t].identity}else if(i)return e[t].identity}}return{browser:n(e),operatingSystem:n(t)}}},n}),cc._RF.pop()},{"hmac-sha256":"hmac-sha256"}],"hmac-sha256":[function(e,t,n){"use strict";cc._RF.push(t,"28c1c0JCuVEK7AMdWbaZWIb","hmac-sha256"),window.CryptoJS=window.CryptoJS||function(e,t){var n={},i=n.lib={},s=function(){},o=i.Base={extend:function(e){s.prototype=this;var t=new s;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},r=i.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var s=0;s<e;s++)t[i+s>>>2]|=(n[s>>>2]>>>24-s%4*8&255)<<24-(i+s)%4*8;else if(65535<n.length)for(s=0;s<e;s+=4)t[i+s>>>2]=n[s>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],i=0;i<t;i+=4)n.push(4294967296*e.random()|0);return new r.init(n,t)}}),a=n.enc={},l=a.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++){var s=t[i>>>2]>>>24-i%4*8&255;n.push((s>>>4).toString(16)),n.push((15&s).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new r.init(n,t/2)}},c=a.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++)n.push(String.fromCharCode(t[i>>>2]>>>24-i%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new r.init(n,t)}},h=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},u=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,s=n.sigBytes,o=this.blockSize,a=s/(4*o);if(t=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,s=e.min(4*t,s),t){for(var l=0;l<t;l+=o)this._doProcessBlock(i,l);l=i.splice(0,t),n.sigBytes-=s}return new r.init(l,s)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=u.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new p.HMAC.init(e,n).finalize(t)}}});var p=n.algo={};return n}(Math),function(e){for(var t=CryptoJS,n=(s=t.lib).WordArray,i=s.Hasher,s=t.algo,o=[],r=[],a=function(e){return 4294967296*(e-(0|e))|0},l=2,c=0;64>c;){var h;e:{h=l;for(var u=e.sqrt(h),p=2;p<=u;p++)if(!(h%p)){h=!1;break e}h=!0}h&&(8>c&&(o[c]=a(e.pow(l,.5))),r[c]=a(e.pow(l,1/3)),c++),l++}var d=[];s=s.SHA256=i.extend({_doReset:function(){this._hash=new n.init(o.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],s=n[1],o=n[2],a=n[3],l=n[4],c=n[5],h=n[6],u=n[7],p=0;64>p;p++){if(16>p)d[p]=0|e[t+p];else{var g=d[p-15],f=d[p-2];d[p]=((g<<25|g>>>7)^(g<<14|g>>>18)^g>>>3)+d[p-7]+((f<<15|f>>>17)^(f<<13|f>>>19)^f>>>10)+d[p-16]}g=u+((l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25))+(l&c^~l&h)+r[p]+d[p],f=((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+(i&s^i&o^s&o),u=h,h=c,c=l,l=a+g|0,a=o,o=s,s=i,i=g+f|0}n[0]=n[0]+i|0,n[1]=n[1]+s|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+l|0,n[5]=n[5]+c|0,n[6]=n[6]+h|0,n[7]=n[7]+u|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,s=8*t.sigBytes;return n[s>>>5]|=128<<24-s%32,n[14+(s+64>>>9<<4)]=e.floor(i/4294967296),n[15+(s+64>>>9<<4)]=i,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(s),t.HmacSHA256=i._createHmacHelper(s)}(Math),function(){var e=CryptoJS,t=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,n){e=this._hasher=new e.init,"string"==typeof n&&(n=t.parse(n));var i=e.blockSize,s=4*i;n.sigBytes>s&&(n=e.finalize(n)),n.clamp();for(var o=this._oKey=n.clone(),r=this._iKey=n.clone(),a=o.words,l=r.words,c=0;c<i;c++)a[c]^=1549556828,l[c]^=909522486;o.sigBytes=r.sigBytes=s,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})}(),function(){var e=CryptoJS,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp();e=[];for(var s=0;s<n;s+=3)for(var o=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,r=0;4>r&&s+.75*r<n;r++)e.push(i.charAt(o>>>6*(3-r)&63));if(t=i.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var n=(e=e.replace(/\s/g,"")).length,i=this._map;(s=i.charAt(64))&&(-1!=(s=e.indexOf(s))&&(n=s));for(var s=[],o=0,r=0;r<n;r++)if(r%4){var a=i.indexOf(e.charAt(r-1))<<r%4*2,l=i.indexOf(e.charAt(r))>>>6-r%4*2;s[o>>>2]|=(a|l)<<24-o%4*8,o++}return t.create(s,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),cc._RF.pop()},{}],playerMgr:[function(e,t,n){"use strict";cc._RF.push(t,"9193487NndIPbGpW0tNuKGj","playerMgr");e("EventHandler");var i=e("GameSparksRTMgr");cc.Class({extends:cc.Component,properties:{sp_player1:cc.SpriteFrame,sp_player2:cc.SpriteFrame,maxMoveSpeed:0,accel:0,node_score:cc.Node},onLoad:function(){this.accLeft=!1,this.accRight=!1,this.xSpeed=0,this.score=0,this.P2_accLeft=!1,this.P2_accRight=!1,this.P2_xSpeed=0,this.P2_posX=0,this.isSlowly=!1,this.timeSlow=0,cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},gainScore:function(){this.score+=1,this.node_score.getComponent(cc.Label).string=""+this.score,i.instance.isMultiplayer&&i.instance.onRequestGainScore(""+this.score)},getScore:function(){return this.score},setScoreDisplay:function(e){this.node_score.getComponent(cc.Label).string=""+e},Slowdown:function(){this.timeSlow=TIME_SLOW,this.isSlowly=!0,this.callback=function(){this.timeSlow<=0?(this.isSlowly=!1,this.unschedule(this.callback)):this.scheduleOnce(function(){this.timeSlow--})},this.schedule(this.callback,1)},onKeyDown:function(e){switch(e.keyCode){case cc.macro.KEY.q:this.accLeft=!0;break;case cc.macro.KEY.e:this.accRight=!0}},onKeyUp:function(e){switch(e.keyCode){case cc.macro.KEY.q:this.accLeft=!1,this.xSpeed=0;break;case cc.macro.KEY.e:this.accRight=!1,this.xSpeed=0}},initplayerMulti:function(e){this.setPlayerType(e)},setPlayerType:function(e){this.playerType=e,this.setImageForPlayer()},getPlayerType:function(){return this.playerType},setImageForPlayer:function(){this.getPlayerType()==PLAYER_TYPE.PLAYER_1?this.node.getComponent(cc.Sprite).spriteFrame=this.sp_player1:this.getPlayerType()==PLAYER_TYPE.PLAYER_2&&(this.node.getComponent(cc.Sprite).spriteFrame=this.sp_player2)},update:function(e){this.getPlayerType()==PLAYER_TYPE.PLAYER_2?this.node.x=this.P2_posX:this.getPlayerType()==PLAYER_TYPE.PLAYER_1&&(this.accLeft?(this.xSpeed-=this.accel,this.isSlowly&&(this.xSpeed=-SPEED_SLOW),i.instance.isMultiplayer&&i.instance.onMovePlayer(KEY_REDIRECT.LEFT_PRESSED,this.node.x)):this.accRight&&(this.xSpeed+=this.accel,this.isSlowly&&(this.xSpeed=SPEED_SLOW),i.instance.isMultiplayer&&i.instance.onMovePlayer(KEY_REDIRECT.RIGHT_PRESSED,this.node.x)),this.node.x+=this.xSpeed)}}),cc._RF.pop()},{EventHandler:"EventHandler",GameSparksRTMgr:"GameSparksRTMgr"}]},{},["Define","EventHandler","Game","GameSparksRTMgr","MultiplayerMgr","OrderMgr","ServerCode","candy","playerMgr","gamesparks-rt","gamesparks","hmac-sha256"]);